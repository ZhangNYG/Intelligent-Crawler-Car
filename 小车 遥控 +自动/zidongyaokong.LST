C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE ZIDONGYAOKONG
OBJECT MODULE PLACED IN zidongyaokong.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE zidongyaokong.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #include <stdlib.h>     //随机数头文件  srand  rand 
   4          void zuo();
   5          void you();
   6          sbit p2_0 = P2^0;
   7          sbit p2_1 = P2^1;
   8          sbit p2_2 = P2^2;
   9          sbit p2_3 = P2^3;
  10          sbit p1_0 = P1^0;
  11          sbit p1_1 = P1^1;
  12          sbit p1_2 = P1^2;
  13          sbit p1_3 = P1^3;
  14          unsigned int  time=0;
  15          unsigned int  timer=0;
  16          unsigned char posit=0;
  17          unsigned long S=0;
  18          bit      flag =0;
  19          sbit  RX  =P2^6;
  20          sbit  TX  =P2^7;
  21          //sbit  ena  =P3^0;
  22          //sbit  enb  =P3^2;
  23          
  24          //////////////////////////////////////////////////////////
  25          sbit in1=P1^4;
  26          sbit in2=P1^5;
  27          sbit in3=P1^6;
  28          sbit in4=P1^7;
  29          sbit right=P3^0;
  30          sbit lift=P3^1;
  31          ////////////////////////////////////////////////////////////
  32          /*******************************共阳LED段码表*******************************/
  33          unsigned char code table[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  34          /*******************************定义全局变量********************************/
  35          /*********************************端口定义**********************************/
  36          /////////////////////////////////////////////////////////////////////////
  37          void delay1(unsigned int a)
  38          { 
  39   1      
  40   1      unsigned int i,j,k;
  41   1      for(i=a;i>0;i--)
  42   1          for(j=100;j>0;j--)
  43   1              for(k=100;k>0;k--);
  44   1      }
  45          /////////////////////////////////////////////////////////////////
  46          void delay2(unsigned int s)
  47          {
  48   1              unsigned int i;
  49   1              for(i=0; i<s; i++);
  50   1      
  51   1      }
  52          
  53          /********************************************************/
  54          void delay3(unsigned int n)
  55          {
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 2   

  56   1         unsigned int v,l=0;
  57   1         for(l=n;n>0;n--)
  58   1         for(v=0;v<20;v++);
  59   1      }                                       
  60          /****************************************************************************
  61          函数功能:数码管扫描延时子程序
  62          入口参数:
  63          出口参数:
  64          ****************************************************************************/
  65          
  66          /****************************************************************************
  67          函数功能:LED数码管显示程序
  68          入口参数:k
  69          出口参数:
  70          ****************************************************************************/
  71          void Display(unsigned long x)
  72          {  
  73   1      
  74   1      
  75   1      p2_0=0;p2_1=1;p2_2=1;p2_3=1;
  76   1      P0 =table[x/100%10];
  77   1      delay3(10);
  78   1      
  79   1      
  80   1      p2_0=1;p2_1=0;p2_2=1;p2_3=1;
  81   1      P0 =table[x/10%10];
  82   1      delay3(10);
  83   1      
  84   1      p2_0=1;p2_1=1;p2_2=0;p2_3=1;
  85   1      P0 =table[x%10];
  86   1      delay3(10);
  87   1      
  88   1      p2_0=1;p2_1=1;p2_2=1;p2_3=0;
  89   1      P0 =table[x/1000%10];
  90   1      delay3(10);
  91   1      
  92   1      p2_3=1;
  93   1      delay3(6);
  94   1      
  95   1      }
  96                          //关闭个位数码管
  97          /*void display(int a)
  98          {
  99          unsigned int k=200;
 100          
 101          while  (k--)
 102          {
 103          p2_0=0;p2_1=1;p2_2=1;p2_3=1;
 104          P0 =table[a/1000%10];
 105          delay(2);
 106          
 107          
 108          p2_0=1;p2_1=0;p2_2=1;p2_3=1;
 109          P0 =table[a/100%10];
 110          delay(2);
 111          
 112          p2_0=1;p2_1=1;p2_2=0;p2_3=1;
 113          P0 =table[a/10%10];
 114          delay(2);
 115          
 116          p2_0=1;p2_1=1;p2_2=1;p2_3=0;
 117          P0 =table[a%10];
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 3   

 118          delay(2);
 119          }                                                       
 120          } */
 121          void Conut(void)
 122                  {
 123   1               time=TH0*256+TL0;
 124   1               TH0=0;
 125   1               TL0=0;
 126   1              
 127   1               S=(time*1.7)/100;     //算出来是CM
 128   1               if((S>=400)||flag==1) //超出测量范围显示“-”
 129   1               {       
 130   2                flag=0;
 131   2                S=500;
 132   2               }
 133   1               }
 134          
 135          void juli(unsigned int x)       //x为小车转弯距离单位厘米
 136          {
 137   1              unsigned int a;
 138   1              unsigned int b;
 139   1              unsigned int c;
 140   1              unsigned int t=0;
 141   1              unsigned int g=0;
 142   1              unsigned int h=0;
 143   1      
 144   1      
 145   1              /////////////////////////////////////////////////////////////////////////////////////////////////////////
             -/
 146   1              // 距离大于是
 147   1              
 148   1              
 149   1         while(S<x)
 150   1              
 151   1              
 152   1              {
 153   2                      ///////////////////////////////////////////////////////////////
 154   2                      if (h==0)
 155   2      
 156   2                      {
 157   3                      h++;
 158   3                      delay3(400)     ;
 159   3                      right=1;
 160   3                      lift=1;
 161   3                      in1=0;
 162   3                      in2=1;
 163   3                      in3=1;
 164   3                      in4=0;
 165   3                      delay3(300) ;
 166   3                      }
 167   2                      delay3(400)     ;
 168   2                      //         srand(t);
 169   2                      //         a=((char)rand())%10;
 170   2                      //         b=(a+1)%2; 
 171   2                      //         c=a%2;  
 172   2                      right=0;
 173   2                      lift=0;
 174   2                      delay1(5);
 175   2                      right=1;
 176   2                      lift=1;
 177   2                      in1=b;
 178   2                      in2=c;
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 4   

 179   2                      in3=b;
 180   2                      in4=c;
 181   2                      
 182   2                      
 183   2                      
 184   2                      ////////////////////////////////////////////////////////////////////
 185   2                      
 186   2                      while(!RX);             //当RX为零时等待
 187   2                      TR0=1;                      //开启计数
 188   2                      while(RX);                      //当RX为1计数并等待
 189   2                      TR0=0;                          //关闭计数
 190   2                      Conut();                        //计算
 191   2                      //     P1=0X00;
 192   2                              
 193   2      
 194   2                      delay2(5000);
 195   2                      //     P1=0X09;
 196   2                      if(p1_1==1||p1_2==1||p1_3==1)return;
 197   2                      if(S>=x) {right=0;lift=0;delay3(6000);  }
 198   2                      
 199   2      
 200   2              }
 201   1      
 202   1      
 203   1      
 204   1      
 205   1              ////////////////////////////////////////////////////////////////////////////////////////////////////////
 206   1         while(S>=x)
 207   1              {        
 208   2                      //产生随机数
 209   2                      //////////////////////////////////////////////////////
 210   2                      srand(t);
 211   2                      
 212   2                              
 213   2                      a=((char)rand())%10;
 214   2                      b=(a+1)%2; 
 215   2                      c=a%2;
 216   2                      t++;
 217   2                      if(t==100){t=0;}
 218   2                      ///////////////////////////////////
 219   2              
 220   2              
 221   2          
 222   2      
 223   2              
 224   2                      
 225   2      
 226   2              
 227   2                      
 228   2                      ////////////////////////////////////////////////
 229   2                      right=1;
 230   2                      lift=1;
 231   2                      in1=1;
 232   2                      in2=0;
 233   2                      in3=0;
 234   2                      in4=1;
 235   2                                      
 236   2      
 237   2                      
 238   2              
 239   2                      //////////////////////////////////////////////////////
 240   2                      while(!RX);                                                             //当RX为零时等待
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 5   

 241   2                      TR0=1;                                                                   //开启计数
 242   2                      while(RX);                                                                 //当RX为1计数并等待
 243   2                      TR0=0;                                                                  //关闭计数
 244   2                      Conut();
 245   2                              
 246   2      
 247   2                      delay2(10000);
 248   2                                      if(p1_1==1||p1_2==1||p1_3==1)return;
 249   2              
 250   2      
 251   2                                                                       //     P1=0X00;
 252   2                      
 253   2                      
 254   2              
 255   2                      
 256   2      
 257   2       
 258   2      
 259   2                      
 260   2                                                                                     //     P1=0X0B;
 261   2              
 262   2              }
 263   1              
 264   1      
 265   1      }
 266          //////////////////////////////////////////////////////////////////////////////////////
 267          ///////////////////////////////////////////////////////////////////////////////////////
 268          void you()
 269          {
 270   1              right=0;
 271   1              lift=0;
 272   1              delay1(5);
 273   1              right=1;
 274   1              lift=1;
 275   1              in1=1;
 276   1              in2=0;
 277   1              in3=1;
 278   1              in4=0;
 279   1      
 280   1      
 281   1      //      while(!RX);                 //当RX为零时等待
 282   1      //      TR0=1;                      //开启计数
 283   1      //      while(RX);                      //当RX为1计数并等待
 284   1      //      TR0=0;                          //关闭计数
 285   1      //      Conut();                        //计算
 286   1      //     P1=0X00;
 287   1          delay3(3500);
 288   1      
 289   1      
 290   1      }
 291          void zuo()
 292          {
 293   1          int k=1;
 294   1              while(k--)
 295   1      
 296   1      
 297   1              {
 298   2              right=0;
 299   2              lift=0;
 300   2              delay1(5);
 301   2              right=1;
 302   2              lift=1;
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 6   

 303   2              in1=0;
 304   2              in2=1;
 305   2              in3=0;
 306   2              in4=1;
 307   2              
 308   2              
 309   2      //      while(!RX);             //当RX为零时等待
 310   2      //      TR0=1;                      //开启计数
 311   2      //      while(RX);                      //当RX为1计数并等待
 312   2      //      TR0=0;                          //关闭计数
 313   2      //      Conut();                        //计算
 314   2      //      //     P1=0X00;
 315   2              delay3(3500); 
 316   2              }
 317   1              
 318   1         
 319   1              
 320   1      
 321   1      }
 322          void zd0() interrupt 1           //T0中断用来计数器溢出,超过测距范围
 323          {
 324   1        TH0=0;
 325   1        TL0=0;
 326   1        flag=1;
 327   1      
 328   1                                       //中断溢出标志
 329   1      }
 330          /********************************************************/
 331          void  zd3()  interrupt 3                 //T1中断用来扫描数码管和计800MS启动模块
 332          {
 333   1      ///////////////////////////////
 334   1      
 335   1      TH1=0x75;
 336   1      TL1=0x30;
 337   1      Display(S);
 338   1      timer++;
 339   1      if(timer>=10)
 340   1      {
 341   2              timer=0;
 342   2              TX=1;                                   //800MS  启动一次模块
 343   2              
 344   2              _nop_(); 
 345   2              _nop_(); 
 346   2              _nop_(); 
 347   2              _nop_(); 
 348   2              _nop_(); 
 349   2              _nop_(); 
 350   2              _nop_(); 
 351   2              _nop_(); 
 352   2              _nop_(); 
 353   2              _nop_();
 354   2              _nop_(); 
 355   2              _nop_(); 
 356   2              _nop_(); 
 357   2              _nop_();
 358   2              
 359   2              TX=0;
 360   2      
 361   2      } 
 362   1      }
 363          ////////////////////////////
 364          ///外部中断
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 7   

 365          void T1_tijkhge() interrupt 2
 366          {
 367   1      zuo();
 368   1      
 369   1      
 370   1      }
 371          void T0_tijkhge() interrupt 0
 372          {
 373   1      you();
 374   1      
 375   1      
 376   1      }
 377          
 378          
 379          
 380          //*********
 381          /****************************************************************************
 382          函数功能:主程序
 383          入口参数:
 384          出口参数:
 385          ****************************************************************************/
 386          void main(void)
 387          {       
 388   1              TMOD=0x11;                 //设T0为方式1，GATE=1；
 389   1              TH0=0;
 390   1              TL0=0;          
 391   1              TH1=0x75;                  //2MS定时
 392   1              TL1=0x30;
 393   1              ET0=1;              //允许T0中断
 394   1              EX1=1;              //waibuzhongduan外部中断1
 395   1              EX0=1;                          //外部中断0
 396   1              ET1=1;                     //允许T1中断
 397   1              TR1=1; 
 398   1                 //开启定时器
 399   1              IT1=1;   //外部中断1触发方式
 400   1              IT0=1;   //外部中断0的触发方式
 401   1              EA=1;
 402   1                         //开启总中断
 403   1               
 404   1      //      char datavalue;
 405   1      //////////////////////////////////////////////////////////////////////////
 406   1              while(!RX);             //当RX为零时等待
 407   1                      TR0=1;                      //开启计数
 408   1                      while(RX);                      //当RX为1计数并等待
 409   1                      TR0=0;                          //关闭计数
 410   1                      Conut();                        //计算
 411   1                      //     P1=0X00;
 412   1                              
 413   1      
 414   1                      delay2(5000);
 415   1                                                      
 416   1                                                              //置输入状态
 417   1       ///////////////////////////////////////////////////////////////////////////// 
 418   1      while(1)
 419   1      {
 420   2                                              //端口初始化
 421   2      if(p1_0==1||p1_1==1||p1_2==1||p1_3==1)
 422   2      {       
 423   3       
 424   3               if(p1_0==1)
 425   3               {
 426   4                   right=0;
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 8   

 427   4                       lift=0;
 428   4                                       
 429   4                 
 430   4               }
 431   3               if(p1_3==1)
 432   3               {
 433   4                  right=1;
 434   4                      lift=1;
 435   4                      in1=1;
 436   4                      in2=0;
 437   4                      in3=1;
 438   4                      in4=0;
 439   4                      delay3(1000);
 440   4                      right=1;
 441   4                      lift=1;
 442   4                      in1=1;
 443   4                      in2=0;
 444   4                      in3=0;
 445   4                      in4=1;
 446   4                       
 447   4               }
 448   3                if(p1_2==1)
 449   3               {
 450   4                 
 451   4                      right=1;
 452   4                      lift=1;
 453   4                      in1=0;
 454   4                      in2=1;
 455   4                      in3=1;
 456   4                      in4=0;
 457   4                       
 458   4               }
 459   3               if(p1_1==1)
 460   3               {
 461   4                      right=1;
 462   4                      lift=1;
 463   4                      in1=0;
 464   4                      in2=1;
 465   4                      in3=0;
 466   4                      in4=1;
 467   4                      delay3(1000);
 468   4                      right=1;
 469   4                      lift=1;
 470   4                      in1=1;
 471   4                      in2=0;
 472   4                      in3=0;
 473   4                      in4=1;
 474   4      
 475   4               }
 476   3              
 477   3      }
 478   2              
 479   2                      else
 480   2                               juli(27);                 
 481   2              
 482   2               
 483   2      }
 484   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1082    ----
C51 COMPILER V9.01   ZIDONGYAOKONG                                                         09/01/2013 08:54:37 PAGE 9   

   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      16
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
