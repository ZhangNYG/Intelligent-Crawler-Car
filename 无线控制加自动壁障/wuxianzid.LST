C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE WUXIANZID
OBJECT MODULE PLACED IN wuxianzid.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE wuxianzid.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #include <intrins.h>
   3          #include <stdlib.h>     //随机数头文件  srand  rand 
   4          void zuo();
   5          void you();
   6          sbit p2_0 = P2^0;
   7          sbit p2_1 = P2^1;
   8          sbit p2_2 = P2^2;
   9          sbit p2_3 = P2^3;
  10          sbit p1_0 = P1^0;
  11          sbit p1_1 = P1^1;
  12          sbit p1_2 = P1^2;
  13          sbit p1_3 = P1^3;
  14          unsigned int  time=0;
  15          unsigned int  timer=0;
  16          unsigned char posit=0;
  17          unsigned long S=0;
  18          bit      flag =0;
  19          sbit  RX  =P2^6;
  20          sbit  TX  =P2^7;
  21          //sbit  ena  =P3^0;
  22          //sbit  enb  =P3^2;
  23          
  24          //////////////////////////////////////////////////////////
  25          sbit in1=P1^4;
  26          sbit in2=P1^5;
  27          sbit in3=P1^6;
  28          sbit in4=P1^7;
  29          sbit right=P3^0;
  30          sbit lift=P3^1;
  31          ////////////////////////////////////////////////////////////
  32          /*******************************共阳LED段码表*******************************/
  33          unsigned char code table[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  34          /*******************************定义全局变量********************************/
  35          /*********************************端口定义**********************************/
  36          /////////////////////////////////////////////////////////////////////////
  37          void delay1(unsigned int a)
  38          { 
  39   1      
  40   1      unsigned int i,j,k;
  41   1      for(i=a;i>0;i--)
  42   1          for(j=100;j>0;j--)
  43   1              for(k=100;k>0;k--);
  44   1      }
  45          /////////////////////////////////////////////////////////////////
  46          void delay2(unsigned int s)
  47          {
  48   1              unsigned int i;
  49   1              for(i=0; i<s; i++);
  50   1      
  51   1      }
  52          
  53          /********************************************************/
  54          void delay3(unsigned int n)
  55          {
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 2   

  56   1         unsigned int v,l=0;
  57   1         for(l=n;n>0;n--)
  58   1         for(v=0;v<20;v++);
  59   1      }                                       
  60          /****************************************************************************
  61          函数功能:数码管扫描延时子程序
  62          入口参数:
  63          出口参数:
  64          ****************************************************************************/
  65          
  66          /****************************************************************************
  67          函数功能:LED数码管显示程序
  68          入口参数:k
  69          出口参数:
  70          ****************************************************************************/
  71          void Display(unsigned long x)
  72          {  
  73   1      
  74   1      
  75   1      p2_0=0;p2_1=1;p2_2=1;p2_3=1;
  76   1      P0 =table[x/100%10];
  77   1      delay3(4);
  78   1      
  79   1      
  80   1      p2_0=1;p2_1=0;p2_2=1;p2_3=1;
  81   1      P0 =table[x/10%10];
  82   1      delay3(4);
  83   1      
  84   1      p2_0=1;p2_1=1;p2_2=0;p2_3=1;
  85   1      P0 =table[x%10];
  86   1      delay3(4);
  87   1      
  88   1      p2_0=1;p2_1=1;p2_2=1;p2_3=0;
  89   1      P0 =table[x/1000%10];
  90   1      delay3(4);
  91   1      
  92   1      p2_3=1;
  93   1      delay3(1);
  94   1      
  95   1      }
  96                          //关闭个位数码管
  97          /*void display(int a)
  98          {
  99          unsigned int k=200;
 100          
 101          while  (k--)
 102          {
 103          p2_0=0;p2_1=1;p2_2=1;p2_3=1;
 104          P0 =table[a/1000%10];
 105          delay(2);
 106          
 107          
 108          p2_0=1;p2_1=0;p2_2=1;p2_3=1;
 109          P0 =table[a/100%10];
 110          delay(2);
 111          
 112          p2_0=1;p2_1=1;p2_2=0;p2_3=1;
 113          P0 =table[a/10%10];
 114          delay(2);
 115          
 116          p2_0=1;p2_1=1;p2_2=1;p2_3=0;
 117          P0 =table[a%10];
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 3   

 118          delay(2);
 119          }                                                       
 120          } */
 121          void Conut(void)
 122                  {
 123   1               time=TH0*256+TL0;
 124   1               TH0=0;
 125   1               TL0=0;
 126   1              
 127   1               S=(time*1.7)/100;     //算出来是CM
 128   1               if((S>=400)||flag==1) //超出测量范围显示“-”
 129   1               {       
 130   2                flag=0;
 131   2                S=500;
 132   2               }
 133   1               }
 134          
 135          void juli(unsigned int x)       //x为小车转弯距离单位厘米
 136          {
 137   1              unsigned int a;
 138   1              unsigned int b;
 139   1              unsigned int c;
 140   1              unsigned int t=0;
 141   1              unsigned int g=0;
 142   1      
 143   1              /////////////////////////////////////////////////////////////////////////////////////////////////////////
             -/
 144   1              // 距离大于是
 145   1              
 146   1              
 147   1         while(S<x)
 148   1              
 149   1              
 150   1              {
 151   2                      ///////////////////////////////////////////////////////////////
 152   2                      
 153   2                      //         srand(t);
 154   2                      //         a=((char)rand())%10;
 155   2                      //         b=(a+1)%2; 
 156   2                      //         c=a%2;  
 157   2                      right=0;
 158   2                      lift=0;
 159   2                      delay1(5);
 160   2                      right=1;
 161   2                      lift=1;
 162   2                      in1=b;
 163   2                      in2=c;
 164   2                      in3=b;
 165   2                      in4=c;
 166   2                      
 167   2                      
 168   2                      
 169   2                      ////////////////////////////////////////////////////////////////////
 170   2                      
 171   2                      while(!RX);             //当RX为零时等待
 172   2                      TR0=1;                      //开启计数
 173   2                      while(RX);                      //当RX为1计数并等待
 174   2                      TR0=0;                          //关闭计数
 175   2                      Conut();                        //计算
 176   2                      //     P1=0X00;
 177   2                      delay2(1000);
 178   2                      //     P1=0X09;
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 4   

 179   2              
 180   2      
 181   2              }
 182   1      
 183   1      
 184   1      
 185   1      
 186   1              ////////////////////////////////////////////////////////////////////////////////////////////////////////
 187   1         while(S>=x)
 188   1              {        
 189   2                      //产生随机数
 190   2                      //////////////////////////////////////////////////////
 191   2                      srand(t);
 192   2                      
 193   2                              
 194   2                      a=((char)rand())%10;
 195   2                      b=(a+1)%2; 
 196   2                      c=a%2;
 197   2                      t++;
 198   2                      if(t==100){t=0;}
 199   2                      ///////////////////////////////////  
 200   2          
 201   2      
 202   2              
 203   2                      
 204   2      
 205   2              
 206   2                      
 207   2                      ////////////////////////////////////////////////
 208   2                      right=1;
 209   2                      lift=1;
 210   2                      in1=1;
 211   2                      in2=0;
 212   2                      in3=0;
 213   2                      in4=1;
 214   2                      
 215   2                      
 216   2              
 217   2                      //////////////////////////////////////////////////////
 218   2                      while(!RX);                                                             //当RX为零时等待
 219   2                      TR0=1;                                                                   //开启计数
 220   2                      while(RX);                                                                 //当RX为1计数并等待
 221   2                      TR0=0;                                                                  //关闭计数
 222   2                      Conut();
 223   2                      delay2(1000);
 224   2                                                                       //     P1=0X00;
 225   2                      
 226   2                      
 227   2              
 228   2                      
 229   2      
 230   2       
 231   2      
 232   2                      
 233   2                                                                                     //     P1=0X0B;
 234   2              
 235   2              }
 236   1              
 237   1      
 238   1      }
 239          //////////////////////////////////////////////////////////////////////////////////////
 240          ///////////////////////////////////////////////////////////////////////////////////////
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 5   

 241          void you()
 242          {
 243   1              right=0;
 244   1              lift=0;
 245   1              delay1(5);
 246   1              right=1;
 247   1              lift=1;
 248   1              in1=1;
 249   1              in2=0;
 250   1              in3=1;
 251   1              in4=0;
 252   1      
 253   1      
 254   1      //      while(!RX);                 //当RX为零时等待
 255   1      //      TR0=1;                      //开启计数
 256   1      //      while(RX);                      //当RX为1计数并等待
 257   1      //      TR0=0;                          //关闭计数
 258   1      //      Conut();                        //计算
 259   1      //     P1=0X00;
 260   1          delay3(3500);
 261   1      
 262   1      
 263   1      }
 264          void zuo()
 265          {
 266   1          int k=1;
 267   1              while(k--)
 268   1      
 269   1      
 270   1              {
 271   2              right=0;
 272   2              lift=0;
 273   2              delay1(5);
 274   2              right=1;
 275   2              lift=1;
 276   2              in1=0;
 277   2              in2=1;
 278   2              in3=0;
 279   2              in4=1;
 280   2              
 281   2              
 282   2      //      while(!RX);             //当RX为零时等待
 283   2      //      TR0=1;                      //开启计数
 284   2      //      while(RX);                      //当RX为1计数并等待
 285   2      //      TR0=0;                          //关闭计数
 286   2      //      Conut();                        //计算
 287   2      //      //     P1=0X00;
 288   2              delay3(3500); 
 289   2              }
 290   1              
 291   1         
 292   1              
 293   1      
 294   1      }
 295          void zd0() interrupt 1           //T0中断用来计数器溢出,超过测距范围
 296          {
 297   1        TH0=0;
 298   1        TL0=0;
 299   1        flag=1;
 300   1      
 301   1                                       //中断溢出标志
 302   1      }
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 6   

 303          /********************************************************/
 304          void  zd3()  interrupt 3                 //T1中断用来扫描数码管和计800MS启动模块
 305          {
 306   1      ///////////////////////////////
 307   1      
 308   1      TH1=0x75;
 309   1      TL1=0x30;
 310   1      Display(S);
 311   1      timer++;
 312   1      if(timer>=10)
 313   1      {
 314   2              timer=0;
 315   2              TX=1;                                   //800MS  启动一次模块
 316   2              
 317   2              _nop_(); 
 318   2              _nop_(); 
 319   2              _nop_(); 
 320   2              _nop_(); 
 321   2              _nop_(); 
 322   2              _nop_(); 
 323   2              _nop_(); 
 324   2              _nop_(); 
 325   2              _nop_(); 
 326   2              _nop_();
 327   2              _nop_(); 
 328   2              _nop_(); 
 329   2              _nop_(); 
 330   2              _nop_();
 331   2              
 332   2              TX=0;
 333   2      
 334   2      } 
 335   1      }
 336          ////////////////////////////
 337          ///外部中断
 338          void T1_tijkhge() interrupt 2
 339          {
 340   1      zuo();
 341   1      
 342   1      
 343   1      }
 344          void T0_tijkhge() interrupt 0
 345          {
 346   1      you();
 347   1      
 348   1      
 349   1      }
 350          
 351          
 352          
 353          //*********
 354          /****************************************************************************
 355          函数功能:主程序
 356          入口参数:
 357          出口参数:
 358          ****************************************************************************/
 359          void main(void)
 360          {       
 361   1              TMOD=0x11;                 //设T0为方式1，GATE=1；
 362   1              TH0=0;
 363   1              TL0=0;          
 364   1              TH1=0x75;                  //2MS定时
C51 COMPILER V9.01   WUXIANZID                                                             08/29/2013 19:50:50 PAGE 7   

 365   1              TL1=0x30;
 366   1              ET0=1;              //允许T0中断
 367   1              EX1=1;              //waibuzhongduan外部中断1
 368   1              EX0=1;                          //外部中断0
 369   1              ET1=1;                     //允许T1中断
 370   1              TR1=1; 
 371   1                 //开启定时器
 372   1              IT1=1;   //外部中断1触发方式
 373   1              IT0=1;   //外部中断0的触发方式
 374   1              EA=1;
 375   1                         //开启总中断
 376   1               
 377   1      //      char datavalue;
 378   1                                                      
 379   1                                                              //置输入状态
 380   1      while(1)
 381   1      {
 382   2                                              //端口初始化
 383   2               
 384   2               
 385   2                      juli(25) ;
 386   2                      
 387   2                      
 388   2              
 389   2      
 390   2      
 391   2                      
 392   2      }
 393   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    843    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9      14
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
